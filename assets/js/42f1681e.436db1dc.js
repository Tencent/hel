"use strict";(self.webpackChunkhel_doc=self.webpackChunkhel_doc||[]).push([[6106],{8570:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>k});var a=n(79);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),m=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=m(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=m(n),c=l,k=p["".concat(s,".").concat(c)]||p[c]||d[c]||o;return n?a.createElement(k,r(r({ref:t},u),{},{components:n})):a.createElement(k,r({ref:t},u))}));function k(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=n.length,r=new Array(o);r[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:l,r[1]=i;for(var m=2;m<o;m++)r[m]=n[m];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3588:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>m});var a=n(5675),l=(n(79),n(8570));const o={sidebar_position:4},r="helux \u7b80\u4ecb",i={unversionedId:"tutorial/introducing-helux",id:"tutorial/introducing-helux",title:"helux \u7b80\u4ecb",description:"helux \u662f\u4e00\u4e2a\u96c6atom\u3001signal\u3001\u4f9d\u8d56\u6536\u96c6\u4e3a\u4e00\u4f53\u7684 react \u72b6\u6001\u5e93\uff0c\u76f8\u6bd4recoil\u548cjotai\uff0c\u5b83\u62e5\u6709\u4ee5\u4e0b\u4f18\u52bf",source:"@site/docs/tutorial/introducing-helux.md",sourceDirName:"tutorial",slug:"/tutorial/introducing-helux",permalink:"/hel/docs/tutorial/introducing-helux",draft:!1,editUrl:"https://github.com/tnfe/hel/doc/docs/tutorial/introducing-helux.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorial",previous:{title:"\u6a21\u5757\u53d1\u5e03",permalink:"/hel/docs/tutorial/helmod-pub"},next:{title:"\u5b9e\u8df5",permalink:"/hel/docs/tutorial/practise/"}},s={},m=[{value:"\u72b6\u6001\u5b9a\u4e49",id:"\u72b6\u6001\u5b9a\u4e49",level:2},{value:"share",id:"share",level:3},{value:"atom",id:"atom",level:3},{value:"\u6a21\u5757\u5316\u6807\u7b7e",id:"\u6a21\u5757\u5316\u6807\u7b7e",level:3},{value:"\u72b6\u6001\u4f7f\u7528",id:"\u72b6\u6001\u4f7f\u7528",level:2},{value:"\u7ec4\u4ef6\u5185\u4f7f\u7528",id:"\u7ec4\u4ef6\u5185\u4f7f\u7528",level:3},{value:"\u7ec4\u4ef6\u5916\u4f7f\u7528",id:"\u7ec4\u4ef6\u5916\u4f7f\u7528",level:3},{value:"signal",id:"signal",level:2},{value:"signal \u54cd\u5e94",id:"signal-\u54cd\u5e94",level:3},{value:"block \u54cd\u5e94",id:"block-\u54cd\u5e94",level:3},{value:"\u72b6\u6001\u4fee\u6539",id:"\u72b6\u6001\u4fee\u6539",level:2},{value:"\u6d45\u5c42\u6b21\u4fee\u6539",id:"\u6d45\u5c42\u6b21\u4fee\u6539",level:3},{value:"\u6df1\u5c42\u6b21\u4fee\u6539",id:"\u6df1\u5c42\u6b21\u4fee\u6539",level:3},{value:"\u5b9a\u4e49 action \u4fee\u6539",id:"\u5b9a\u4e49-action-\u4fee\u6539",level:3},{value:"\u4f7f\u7528 sync&amp;syncer \u4fee\u6539",id:"\u4f7f\u7528-syncsyncer-\u4fee\u6539",level:3},{value:"watch \u76d1\u542c",id:"watch-\u76d1\u542c",level:2},{value:"\u7ec4\u4ef6\u5916\u89c2\u5bdf\u53d8\u5316",id:"\u7ec4\u4ef6\u5916\u89c2\u5bdf\u53d8\u5316",level:3},{value:"\u7ec4\u4ef6\u5185\u89c2\u5bdf\u53d8\u5316",id:"\u7ec4\u4ef6\u5185\u89c2\u5bdf\u53d8\u5316",level:3},{value:"\u4f9d\u8d56\u6536\u96c6",id:"\u4f9d\u8d56\u6536\u96c6",level:2},{value:"\u666e\u901a\u5bf9\u8c61",id:"\u666e\u901a\u5bf9\u8c61",level:3},{value:"\u6570\u7ec4\u5bf9\u8c61",id:"\u6570\u7ec4\u5bf9\u8c61",level:3},{value:"\u52a8\u6001\u4f9d\u8d56\u6536\u96c6",id:"\u52a8\u6001\u4f9d\u8d56\u6536\u96c6",level:3},{value:"\u81ea\u5b9a\u4e49\u6536\u96c6\u89c4\u5219",id:"\u81ea\u5b9a\u4e49\u6536\u96c6\u89c4\u5219",level:3},{value:"\u53ef\u53d8\u6d3e\u751f",id:"\u53ef\u53d8\u6d3e\u751f",level:2},{value:"\u5355\u53d8\u5316\u51fd\u6570",id:"\u5355\u53d8\u5316\u51fd\u6570",level:3},{value:"\u591a\u53d8\u5316\u51fd\u6570",id:"\u591a\u53d8\u5316\u51fd\u6570",level:3},{value:"\u5f02\u6b65\u6d3e\u751f\u51fd\u6570",id:"\u5f02\u6b65\u6d3e\u751f\u51fd\u6570",level:3},{value:"\u5916\u90e8\u5b9a\u4e49\u53ef\u53d8\u6d3e\u751f",id:"\u5916\u90e8\u5b9a\u4e49\u53ef\u53d8\u6d3e\u751f",level:3},{value:"\u4eba\u5de5\u89e6\u53d1\u91cd\u8fd0\u884c",id:"\u4eba\u5de5\u89e6\u53d1\u91cd\u8fd0\u884c",level:3},{value:"\u5168\u91cf\u6d3e\u751f",id:"\u5168\u91cf\u6d3e\u751f",level:2},{value:"\u540c\u6b65\u5168\u91cf\u6d3e\u751f",id:"\u540c\u6b65\u5168\u91cf\u6d3e\u751f",level:3},{value:"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f",id:"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f",level:3},{value:"\u7ec4\u4ef6\u4f7f\u7528\u5168\u91cf\u6d3e\u751f\u7ed3\u679c",id:"\u7ec4\u4ef6\u4f7f\u7528\u5168\u91cf\u6d3e\u751f\u7ed3\u679c",level:3},{value:"\u4eba\u5de5\u89e6\u53d1\u91cd\u8fd0\u884c",id:"\u4eba\u5de5\u89e6\u53d1\u91cd\u8fd0\u884c-1",level:3},{value:"loading \u7ba1\u7406",id:"loading-\u7ba1\u7406",level:2},{value:"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f loading",id:"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f-loading",level:3},{value:"\u5f02\u6b65\u53ef\u53d8\u6d3e\u751f loading",id:"\u5f02\u6b65\u53ef\u53d8\u6d3e\u751f-loading",level:3},{value:"action \u51fd\u6570 loading",id:"action-\u51fd\u6570-loading",level:3},{value:"\u7ec4\u4ef6\u5916\u90e8\u8bfb\u53d6 loading",id:"\u7ec4\u4ef6\u5916\u90e8\u8bfb\u53d6-loading",level:3},{value:"\u6a21\u5757\u514b\u9686",id:"\u6a21\u5757\u514b\u9686",level:2},{value:"model",id:"model",level:3},{value:"modelFactory",id:"modelfactory",level:3},{value:"\u4e8b\u4ef6\u7cfb\u7edf",id:"\u4e8b\u4ef6\u7cfb\u7edf",level:2},{value:"\u53d1\u5c04\u4e8b\u4ef6",id:"\u53d1\u5c04\u4e8b\u4ef6",level:3},{value:"\u7ec4\u4ef6\u5916\u76d1\u542c\u4e8b\u4ef6",id:"\u7ec4\u4ef6\u5916\u76d1\u542c\u4e8b\u4ef6",level:3},{value:"\u7ec4\u4ef6\u5185\u76d1\u542c\u4e8b\u4ef6",id:"\u7ec4\u4ef6\u5185\u76d1\u542c\u4e8b\u4ef6",level:3},{value:"\u4e2d\u95f4\u4ef6",id:"\u4e2d\u95f4\u4ef6",level:2},{value:"\u5b9a\u4e49\u4e2d\u95f4\u4ef6",id:"\u5b9a\u4e49\u4e2d\u95f4\u4ef6",level:3},{value:"\u4f7f\u7528\u4e2d\u95f4\u4ef6",id:"\u4f7f\u7528\u4e2d\u95f4\u4ef6",level:3},{value:"\u63d2\u4ef6",id:"\u63d2\u4ef6",level:2},{value:"\u5f00\u53d1\u63d2\u4ef6",id:"\u5f00\u53d1\u63d2\u4ef6",level:3},{value:"\u5b89\u88c5\u63d2\u4ef6",id:"\u5b89\u88c5\u63d2\u4ef6",level:3}],u={toc:m},p="wrapper";function d(e){let{components:t,...n}=e;return(0,l.kt)(p,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"helux-\u7b80\u4ecb"},"helux \u7b80\u4ecb"),(0,l.kt)("p",null,"helux \u662f\u4e00\u4e2a\u96c6",(0,l.kt)("inlineCode",{parentName:"p"},"atom"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"signal"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"\u4f9d\u8d56\u6536\u96c6"),"\u4e3a\u4e00\u4f53\u7684 react \u72b6\u6001\u5e93\uff0c\u76f8\u6bd4",(0,l.kt)("inlineCode",{parentName:"p"},"recoil"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"jotai"),"\uff0c\u5b83\u62e5\u6709\u4ee5\u4e0b\u4f18\u52bf"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u57fa\u4e8e\u6700\u5feb\u7684\u4e0d\u53ef\u53d8 js \u5e93",(0,l.kt)("a",{parentName:"li",href:"https://github.com/tnfe/limu"},"limu"),"\u5f00\u53d1\uff0c\u62e5\u6709\u8d85\u5f3a\u6027\u80fd"),(0,l.kt)("li",{parentName:"ul"},"atom \u652f\u6301\u4f9d\u8d56\u6536\u96c6\uff0c\u610f\u5473\u7740 atom \u4e0d\u7528\u62c6\u5206\u7684\u5f88\u7ec6\uff0catom \u5c31\u53ef\u4ee5\u7b49\u540c\u4e8e model\uff0c\u5929\u7136\u5bf9 ",(0,l.kt)("inlineCode",{parentName:"li"},"DDD")," \u9886\u57df\u9a71\u52a8\u8bbe\u8ba1\u53cb\u597d"),(0,l.kt)("li",{parentName:"ul"},"\u5185\u7f6e signal \u54cd\u5e94\u673a\u5236\uff0c\u53ef\u76f4\u63a5\u5c06\u5171\u4eab\u5bf9\u8c61\u7684\u503c\u4ea4\u7ed9 signal \u6216 block \u89c6\u56fe\u4e0e\u6570\u636e\u5173\u7cfb\u7684\u7ed1\u5b9a\uff0c\u5b9e\u73b0 0 hook \u7f16\u7801\uff0c\u5b9e\u73b0 dom \u7c92\u5ea6\u7684\u66f4\u65b0"),(0,l.kt)("li",{parentName:"ul"},"\u5185\u7f6e loading \u6a21\u5757\uff0c\u53ef\u5bf9\u6240\u6709\u5f02\u6b65\u4efb\u52a1\u505a\u8fd0\u884c\u72b6\u6001\u3001\u9519\u8bef\u6355\u6349\u505a\u7ba1\u7406"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301\u53ef\u53d8\u6d3e\u751f\uff0c\u5f53\u5171\u4eab\u5bf9\u8c61 a \u7684\u53d1\u751f\u53d8\u5316\u540e\u9700\u8981\u81ea\u52a8\u5f15\u8d77\u5171\u4eab\u72b6\u6001 b \u7684\u67d0\u4e9b\u8282\u70b9\u53d8\u5316\u65f6\uff0c\u53ef\u5b9a\u4e49 mutate \u51fd\u6570\u6765\u5b8c\u6210\u8fd9\u79cd\u53d8\u5316\u7684\u8fde\u9501\u53cd\u5e94\u5173\u7cfb\uff0c\u5bf9\u6570\u636e\u505a\u6700\u5c0f\u7c92\u5ea6\u7684\u66f4\u65b0"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301\u5168\u91cf\u6d3e\u751f\uff0c\u4e0d\u9700\u8981\u5bf9\u6570\u636e\u505a\u7ec6\u7c92\u5ea6\u66f4\u65b0\u65f6\u4f7f\u7528\u5168\u91cf\u6d3e\u751f\u66f4\u5408\u9002"),(0,l.kt)("li",{parentName:"ul"},"\u5168\u91cf\u6d3e\u751f\u3001\u53ef\u53d8\u6d3e\u751f\u5747\u652f\u6301\u5f02\u6b65\u4efb\u52a1"),(0,l.kt)("li",{parentName:"ul"},"\u5168\u91cf\u6d3e\u751f\u3001\u53ef\u53d8\u6d3e\u751f\u9664\u6570\u636e\u53d8\u66f4\u9a71\u52a8\u6267\u884c\u5916\uff0c\u8fd8\u652f\u6301\u4eba\u5de5\u91cd\u65b0\u89e6\u53d1\u8fd0\u884c"),(0,l.kt)("li",{parentName:"ul"},"\u5185\u7f6e\u4e8b\u4ef6\u7cfb\u7edf"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301\u4e2d\u95f4\u4ef6\u3001\u63d2\u4ef6\u7cfb\u7edf\uff0c\u53ef\u65e0\u7f1d\u5bf9\u63a5 redux \u751f\u6001\u76f8\u5173\u5de5\u5177\u5e93"),(0,l.kt)("li",{parentName:"ul"},"100% ts \u7f16\u7801\uff0c\u7c7b\u578b\u63d0\u793a\u4f18\u5316")),(0,l.kt)("h2",{id:"\u72b6\u6001\u5b9a\u4e49"},"\u72b6\u6001\u5b9a\u4e49"),(0,l.kt)("h3",{id:"share"},"share"),(0,l.kt)("p",null,"\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"share")," \u63a5\u53e3\u521b\u5efa\u5168\u5c40\u5171\u4eab\u72b6\u6001\uff0cshare \u5fc5\u987b\u4f20\u5165 \u666e\u901a json \u5bf9\u8c61\uff0c\u8fd4\u56de\u4e00\u4e2a\u53ea\u53ef\u8bfb\u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u662f\u4e00\u4e2a\u5168\u5c40\u53ef\u4f7f\u7528\u7684\u7a33\u5b9a\u5f15\u7528\uff0c\u53ef\u603b\u662f\u8bfb\u53d6\u5230\u6700\u65b0\u503c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { share } from 'helux';\n\nconst [sharedNum] = share({ num: 1 }); // { num: 1 }\n")),(0,l.kt)("h3",{id:"atom"},"atom"),(0,l.kt)("p",null,"\u5982\u9700\u5171\u4eab\u539f\u59cb\u503c\u7c7b\u578b\u7684\u503c\uff0c\u53ef\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"atom")," \u63a5\u53e3\u521b\u5efa\u5168\u5c40\u5171\u4eab\u72b6\u6001\uff0catom \u652f\u6301\u4f20\u5165\u6240\u6709\u7c7b\u578b\u7684\u503c\uff0c\u8fd4\u56de\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u8fd4\u56de\u7ed3\u679c\u88ab\u81ea\u52a8\u88c5\u7bb1\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"{ val: T }")," \u7ed3\u6784\uff0c\uff0c\u4e5f\u662f\u4e00\u4e2a\u5168\u5c40\u53ef\u4f7f\u7528\u7684\u7a33\u5b9a\u5f15\u7528\uff0c\u53ef\u603b\u662f\u8bfb\u53d6\u5230\u6700\u65b0\u503c\uff0c\u4f46\u9700\u8981\u591a\u505a\u4e00\u6b21",(0,l.kt)("inlineCode",{parentName:"p"},".val"),"\u53d6\u503c\u64cd\u4f5c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { atom } from 'helux';\n\nconst [numAtom] = atom(1); // { va: 1 }\nconsole.log(numAtom.val); // print: 1\n")),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u4f18\u5148\u8003\u8651 share \u5171\u4eab\u5bf9\u8c61\u7531\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"share"),"\u63a5\u53e3\u6ca1\u6709\u88c5\u7bb1",(0,l.kt)("inlineCode",{parentName:"p"},"{val: T}")," \u7684\u64cd\u4f5c\uff0c\u5f53\u5171\u4eab\u5bf9\u8c61\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"object")," \u65f6\uff0c\u53ef\u4f18\u5148\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"share"),"\u6765\u5171\u4eab\u5bf9\u8c61\uff0c\u907f\u514d\u4e00\u4e9b\u65e0\u81ea\u52a8\u62c6\u7bb1\u7684\u573a\u666f\u591a\u505a\u4e00\u6b21",(0,l.kt)("inlineCode",{parentName:"p"},".val"),"\u53d6\u503c\u64cd\u4f5c")),(0,l.kt)("h3",{id:"\u6a21\u5757\u5316\u6807\u7b7e"},"\u6a21\u5757\u5316\u6807\u7b7e"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helux")," \u5141\u8bb8\u7528\u6237\u6309\u81ea\u5df1\u4ee3\u7801\u7ec4\u7ec7\u4e60\u60ef\u5b58\u653e\u72b6\u6001\uff0c\u5f53\u9700\u8981\u4e2d\u5fc3\u5316\u7ba1\u7406\u7ba1\u7406\u72b6\u6001\u65f6\uff0c\u914d\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"moduleName")," \u540d\u79f0\u5373\u53ef\uff0c\u65b9\u4fbf\u540e\u671f\u63a5\u5165\u5f00\u53d1\u63d2\u4ef6\u6309\u6a21\u5757\u5206\u7c7b\u67e5\u770b\u5404\u4e2a\u72b6\u6001\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [sharedNum] = share({ num: 1 }, { moduleName: 'A' });\nconst [numAtom] = atom(1, { moduleName: 'B' });\n")),(0,l.kt)("admonition",{title:"\u6a21\u5757\u540d\u91cd\u590d",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u56e0 ",(0,l.kt)("inlineCode",{parentName:"p"},"helux")," \u7ef4\u62a4\u4e86\u4e00\u5957\u81ea\u589e id \u7ba1\u7406\u5404\u4e2a\u72b6\u6001\uff0c\u5982\u679c\u6a21\u5757\u540d\u91cd\u590d\uff0c\u5e76\u4e0d\u4f1a\u5bf9 ",(0,l.kt)("inlineCode",{parentName:"p"},"helux")," \u672c\u8eab\u7684\u8fd0\u884c\u9020\u6210\u4efb\u4f55\u5f71\u54cd\uff0c\u53ea\u4f1a\u5f71\u54cd\u72b6\u6001\u7684\u5feb\u7167\u900f\u4f20\u7ed9\u5f00\u53d1\u63d2\u4ef6\u65f6\uff0c\u91cd\u590d\u7684\u4f1a\u88ab\u4e22\u5f03\uff0c\u67e5\u770b\u5230\u7684\u72b6\u6001\u6811\u53ef\u80fd\u6709\u7f3a\u5931")),(0,l.kt)("h2",{id:"\u72b6\u6001\u4f7f\u7528"},"\u72b6\u6001\u4f7f\u7528"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"atom")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"share")," \u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u7a33\u5b9a\u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u53ef\u5168\u5c40\u4efb\u610f\u5730\u65b9\u4f7f\u7528\u5e76\u603b\u662f\u8bfb\u53d6\u5230\u6700\u65b0\u503c"),(0,l.kt)("h3",{id:"\u7ec4\u4ef6\u5185\u4f7f\u7528"},"\u7ec4\u4ef6\u5185\u4f7f\u7528"),(0,l.kt)("p",null,"\u7ec4\u4ef6\u5185\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"useAtom"),"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"atom"),"\u8fd4\u56de\u7684\u5171\u4eab\u5bf9\u8c61\uff0c\u4ece\u800c\u4ea7\u751f\u6570\u636e\u53d8\u66f4\u540e\u91cd\u6e32\u67d3\u7684\u8ba2\u9605\u884c\u4e3a\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"useAtom"),"\u7684\u8fd4\u56de\u503c\u4f1a\u5bf9",(0,l.kt)("inlineCode",{parentName:"p"},"atom"),"\u505a\u81ea\u52a8\u62c6\u7bb1\u64cd\u4f5c"),(0,l.kt)("admonition",{title:"\u81ea\u52a8\u62c6\u7bb1",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"{ val: T }")," \u88ab\u62c6\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"T")," \u8fd4\u56de")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"function DemoUseAtom() {\n  // num \u662f\u81ea\u52a8\u62c6\u7bb1\u540e\u8fd4\u56de\u7684\u503c\n  const [num] = useAtom(numAtom);\n  return <h1>{num}</h1>;\n}\n")),(0,l.kt)("p",null,"\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"useShared"),"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"share"),"\u8fd4\u56de\u7684\u5171\u4eab\u5bf9\u8c61"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"function DemoUseShared() {\n  const [obj] = useShared(sharedNum);\n  return <h1>{obj.num}</h1>;\n}\n")),(0,l.kt)("p",null,"\u9664\u4e86\u9876\u5c42 hook api + \u5177\u4f53\u72b6\u6001\u5bf9\u8c61\u7684\u65b9\u5f0f\u4f7f\u7528\u72b6\u6001\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8fd4\u56de\u7684\u4e0a\u4e0b\u6587\u5bf9\u8c61\u66b4\u9732\u7684\u94a9\u5b50\uff0c\u5185\u90e8\u81ea\u52a8\u7ed1\u5b9a\u4e86\u5bf9\u5e94\u7684\u72b6\u6001"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [shared, setShared, sharedCtx] = share({ num: 1 });\nconst [numAtom, setAtom, numCtx] = atom(1, { moduleName: 'B' });\n\nsharedCtx.useState();\nnumCtx.useState();\n")),(0,l.kt)("admonition",{title:"no provider",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"helux")," \u91c7\u7528\u65e0 ",(0,l.kt)("inlineCode",{parentName:"p"},"Provider")," \u6a21\u5f0f\uff0c\u7528\u6237\u53ea\u9700\u8981\u8c03\u7528\u94a9\u5b50\u51fd\u6570",(0,l.kt)("inlineCode",{parentName:"p"},"useAtom"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"useShared"),"\u5373\u53ef\u4f7f\u7528\u5171\u4eab\u72b6\u6001")),(0,l.kt)("h3",{id:"\u7ec4\u4ef6\u5916\u4f7f\u7528"},"\u7ec4\u4ef6\u5916\u4f7f\u7528"),(0,l.kt)("p",null,"\u5176\u4ed6\u5730\u65b9\u4f7f\u7528\u76f4\u63a5\u8bfb\u53d6\u8fd4\u56de\u7684\u4ee3\u7406\u5bf9\u8c61\u5373\u53ef\uff0c\u53ef\u603b\u662f\u83b7\u53d6\u5230\u6700\u65b0\u503c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"setTimeout(() => {\n  console.log(numAtom.val); // \u6ce8\u610f atom \u5bf9\u8c61\u8fd9\u91cc\u9700\u8981\u81ea\u5df1\u8c03\u7528 .val \u62c6\u7bb1\u6765\u8bfb\u5230\u539f\u59cb\u503c\n  console.log(numShared.num);\n}, 1000);\n")),(0,l.kt)("h2",{id:"signal"},"signal"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"signal"),"\u54cd\u5e94\u673a\u5236\u53ef\u4ee5\u7528\u6237\u9003\u79bb",(0,l.kt)("inlineCode",{parentName:"p"},"hook"),"\uff0c\u76f4\u63a5\u5c06\u6570\u636e\u7ed1\u5b9a\u5230\u89c6\u56fe\uff0c\u5e76\u5efa\u7acb\u8d77\u89c6\u56fe\u5bf9\u6570\u636e\u53d8\u5316\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u8ba9 react \u7684\u6e32\u67d3\u7c92\u5ea6\u4ece",(0,l.kt)("strong",{parentName:"p"},"\u7ec4\u4ef6\u7c92\u5ea6"),"\u964d\u4f4e\u5230",(0,l.kt)("strong",{parentName:"p"},"dom \u7c92\u5ea6"),"\uff0c\u6781\u81f4\u7684\u7f29\u5c0f\u89c6\u56fe\u6e32\u67d3\u8303\u56f4\uff0c\u5927\u5e45\u63d0\u9ad8\u5e94\u7528\u6574\u4f53\u6e32\u67d3\u6027\u80fd\uff01"),(0,l.kt)("h3",{id:"signal-\u54cd\u5e94"},"signal \u54cd\u5e94"),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"signal"),"\u63a5\u53e3\u7ed1\u5b9a atom \u5bf9\u8c61\u539f\u59cb\u503c\u5230\u89c6\u56fe\uff0c\u539f\u59cb\u503c\u53d8\u5316\u65f6\uff0c\u53ef\u76f4\u63a5\u8ba9\u7ed1\u5b9a\u90e8\u5206\u4ea7\u751f\u54cd\u5e94\u5e76\u91cd\u6e32\u67d3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"// $ \u662f signal \u63a5\u53e3\u7684\u7f29\u5199\uff0c\u65b9\u4fbf\u89c6\u56fe\u7ed1\u5b9a\u6570\u636e\u65f6\u66f4\u65b9\u4fbf\nimport { $, atom, signal } from 'helux';\n\nconst [numAtom] = atom(1);\n\n// numAtom \u53d8\u5316\u65f6\uff0c\u4ec5\u6e32\u67d3<h1>\u6807\u7b7e\u5185\u90e8\u7684\u90a3\u4e00\u90e8\u5206\nfunction Demo() {\n  return (\n    <div>\n      <div>... very very long staic content</div>\n      <h1>{$(numAtom)}</h1>\n      <h1>{signal(numAtom)}</h1>\n    </div>\n  );\n}\n")),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"signal"),"\u63a5\u53e3\u7ed1\u5b9a shared \u5bf9\u8c61\u539f\u59cb\u503c\u5230\u89c6\u56fe"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"const [ sharedObj ] = share({a:{a1:1}})\n// \u7ed1\u5b9a\u5230\u89c6\u56fe\u91cc\n<h1>{$(sharedObj.a.a1)}</h1>\n")),(0,l.kt)("admonition",{title:"\u4ec5\u652f\u6301\u54cd\u5e94\u539f\u59cb\u503c",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"jsx \u63d2\u5165 object \u5bf9\u8c61\u672c\u8eab\u4e5f\u662f\u4e0d\u5141\u8bb8\u7684\uff0c\u4f8b\u5982 ",(0,l.kt)("inlineCode",{parentName:"p"},"<div>{obj}</div>")," \u4f1a\u5f15\u8d77\u62a5\u9519\uff0c\u6240\u4ee5 signal \u63a5\u53e3",(0,l.kt)("inlineCode",{parentName:"p"},"<div>{$(obj)}</div>"),"\u540c\u6837\u4e5f\u4f1a\u62a5\u9519")),(0,l.kt)("admonition",{title:"signal \u81ea\u52a8\u62c6\u7bb1",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"atom \u5982 atom \u5bf9\u8c61\u5305\u88f9\u662f\u539f\u59cb\u503c\uff0c\u5c06\u539f\u59cb\u503c\u6216 atom \u5bf9\u8c61\u4f20\u7ed9 signal \u63a5\u53e3\u5747\u80fd\u505a\u51fa\u54cd\u5e94\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"<div>{atom}</div>"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"<div>{atom.val}</div>"),"\u662f\u7b49\u6548\u7684")),(0,l.kt)("h3",{id:"block-\u54cd\u5e94"},"block \u54cd\u5e94"),(0,l.kt)("p",null,"\u9700\u8981\u540c\u65f6\u54cd\u5e94\u4e00\u4e2a\u72b6\u6001\u6216\u591a\u4e2a\u72b6\u6001\u7684\u591a\u4e2a\u503c\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"block"),"\u63a5\u53e3\u521b\u5efa\u4e00\u4e2a\u5757\u7ec4\u4ef6\uff0c\u8be5\u7ec4\u4ef6\u81ea\u52a8\u5bf9\u6e32\u67d3\u51fd\u6570\u91cc\u7528\u5230\u7684\u503c\u5efa\u7acb\u8d77\u4f9d\u8d56\u8ffd\u8e2a\u5173\u7cfb"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"import { share } from 'helux';\nconst [user] = share({\n  name: 'helux',\n  detail: { desc: 'a fatanstic state lib for react like framework' },\n});\n\nconst UserBlock = block(() => (\n  <div>\n    name: {user.name}\n    desc: {user.detail.desc}\n  </div>\n));\n\n// \u5176\u4ed6\u5730\u65b9\u4f7f\u7528 UserBlock\n<UserBlock />;\n")),(0,l.kt)("p",null,"block \u6e32\u67d3\u51fd\u6570\u91cc\u53ef\u4ee5\u7ed1\u5b9a signal \u539f\u59cb\u503c\u54cd\u5e94\uff0c\u62c6\u5206\u51fa\u66f4\u7ec6\u7684\u6e32\u67d3\u7c92\u5ea6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"// user.name \u53d8\u5316\u65f6\u6e32\u67d3\u6574\u7406 UserBlock \u7ec4\u4ef6\uff0cnumAtom \u53d8\u5316\u65f6\u4ec5\u6e32\u67d3\u63d2\u503c\u90e8\u5206\u8282\u70b9\nconst UserBlock = block(() => (\n  <div>\n    name: {user.name}\n    other num: {$(numAtom)}\n  </div>\n));\n")),(0,l.kt)("h2",{id:"\u72b6\u6001\u4fee\u6539"},"\u72b6\u6001\u4fee\u6539"),(0,l.kt)("h3",{id:"\u6d45\u5c42\u6b21\u4fee\u6539"},"\u6d45\u5c42\u6b21\u4fee\u6539"),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"useAtom"),"\u8fd4\u56de\u7684\u4fee\u6539\u53e5\u67c4\u53bb\u4fee\u6539"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function Demo() {\n  const [num, setAtom] = useAtom(numAtom);\n  return <button onClick={() => setAtom(num + 1)}>{num}</button>;\n}\n")),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"atom"),"\u8fd4\u56de\u7684\u4fee\u6539\u53e5\u67c4\u53bb\u4fee\u6539\uff0c\u6b64\u65f6\u53ef\u5c06\u4fee\u6539\u51fd\u6570\u5b9a\u4e49\u5916\u5b9a\u4e49\u5230\u7ec4\u4ef6\u5916\u90e8"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [numAtom, setAtom] = atom(1);\nfunction change() {\n  setAtom(numAtom.val + 1);\n}\nfunction Demo() {\n  const [num] = useAtom(numAtom);\n  return <button onClick={setAtom}>{num}</button>;\n}\n")),(0,l.kt)("h3",{id:"\u6df1\u5c42\u6b21\u4fee\u6539"},"\u6df1\u5c42\u6b21\u4fee\u6539"),(0,l.kt)("p",null,"\u5f53\u5bf9",(0,l.kt)("inlineCode",{parentName:"p"},"atom"),"\u6216",(0,l.kt)("inlineCode",{parentName:"p"},"share"),"\u8fd4\u56de\u7684\u5bf9\u8c61\u4fee\u6539\u65f6\uff0c\u53ef\u4f7f\u7528",(0,l.kt)("strong",{parentName:"p"},"\u53ef\u53d8\u6570\u636e"),"\u505a\u4fee\u6539"),(0,l.kt)("admonition",{title:"\u53ef\u53d8\u6570\u636e",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u53ef\u53d8\u6570\u636e\u57fa\u4e8e",(0,l.kt)("strong",{parentName:"p"},"\u6700\u5feb\u7684"),"\u4e0d\u53ef\u53d8\u6570\u636e js \u5e93",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tnfe/limu"},"limu"),"\u751f\u6210\uff0c\u4fee\u6539\u7ed3\u675f\u540e\uff0c\u4f1a\u751f\u6210\u4e00\u4efd\u5177\u6709\u7ed3\u6784\u5171\u4eab\u7279\u6027\u7684\u65b0\u72b6\u6001")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [numAtom, setAtom] = atom({ num: 1 }); // { val: { num: 1 } }\nconst [numState, setState] = share({ num: 1 }); // { num: 1 }\n\n// \u57fa\u4e8e\u53ef\u53d8\u6570\u636e\u4fee\u6539\u751f\u6210\u65b0\u72b6\u6001\nsetAtom((draft) => {\n  draft.num += 1;\n});\nsetState((draft) => {\n  draft.num += 1;\n});\n")),(0,l.kt)("admonition",{title:"setAtom \u56de\u8c03 draft \u5df2\u62c6\u7bb1",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"setAtom")," \u56de\u8c03\u5df2\u5bf9 ",(0,l.kt)("inlineCode",{parentName:"p"},"draft")," \u5df2\u505a\u62c6\u7bb1\u64cd\u4f5c\uff0c\u5982\u679c\u662f\u539f\u59cb\u503c atom\uff0cdraft \u4e5f\u662f\u539f\u59cb\u503c")),(0,l.kt)("h3",{id:"\u5b9a\u4e49-action-\u4fee\u6539"},"\u5b9a\u4e49 action \u4fee\u6539"),(0,l.kt)("p",null,"\u9664\u4e86\u53ef\u4ee5\u901a\u8fc7\u5c01\u88c5",(0,l.kt)("inlineCode",{parentName:"p"},"setState")," \u8c03\u7528\u8fbe\u5230\u4fee\u6539\u72b6\u6001\u7684\u76ee\u7684"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [numState, setState] = share({ num: 1 }); // { num: 1 }\nfunction methodA(input: number) {\n  setState((draft) => (draft.num = input));\n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helux"),"\u8fd8\u63d0\u4f9b",(0,l.kt)("inlineCode",{parentName:"p"},"action"),"\u5de5\u5382\u51fd\u6570\u521b\u5efa\u4e13\u7528\u4e8e\u4fee\u6539\u72b6\u6001\u7684 action \u540c\u6b65\u6216\u5f02\u6b65\u51fd\u6570\uff0c\u901a\u8fc7 action \u51fd\u6570\u8c03\u7528\u6709 2 \u5927\u597d\u5904"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u63a5\u5165 devltool \u540e\u72b6\u6001\u4fee\u6539\u5386\u53f2\u53ef\u8be6\u7ec6\u8ffd\u6eaf")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5f02\u6b65\u51fd\u6570\u53ef\u81ea\u52a8\u4eab\u53d7\u4e0b\u6587\u63d0\u5230\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"loading"),"\u7ba1\u7406\u80fd\u529b"))),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://tnfe.gtimg.com/image/iu3p7105vx_1699699924785.gif",alt:"cool loading"})),(0,l.kt)("p",null,"\u5b9a\u4e49\u6709\u4e1a\u52a1\u542b\u4e49\u7684\u540c\u6b65 action \u5e76\u7ea6\u675f\u5165\u53c2\u7c7b\u578b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const normalAction = atomAction(numAtom)<[number, string]>(({ setState, args, draft }) => {\n  const val = args[0] && Number.isInteger(args[0]) ? args[0] : random();\n  return val;\n}, 'normalAction');\nnormalAction(1, 1); // \u274c \u7b2c\u4e8c\u4f4d\u53c2\u6570\u5c06\u63d0\u793a\uff1a\u7c7b\u578b\u201cnumber\u201d\u7684\u53c2\u6570\u4e0d\u80fd\u8d4b\u7ed9\u7c7b\u578b\u201cstring\u201d\u7684\u53c2\u6570\n")),(0,l.kt)("p",null,"\u5b9a\u4e49\u6709\u4e1a\u52a1\u542b\u4e49\u7684\u5f02\u6b65 action \u5e76\u7ea6\u675f\u5165\u53c2\u7c7b\u578b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const asyncAction = atomActionAsync(numAtom)<[number, string]>(async ({ setState, args }) => {\n  await delay(2000);\n  const val = args[0] && Number.isInteger(args[0]) ? args[0] : random();\n  return val;\n}, 'asyncAction');\n")),(0,l.kt)("h3",{id:"\u4f7f\u7528-syncsyncer-\u4fee\u6539"},"\u4f7f\u7528 sync&syncer \u4fee\u6539"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"syncer")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"sync")," \u53ef\u4ece\u5bf9\u8c61\u4e0a\u4e0b\u6587\u83b7\u53d6\uff0c\u5185\u90e8\u81ea\u52a8\u5b8c\u6210\u4e86\u4f7f\u7528\u5bf9\u8c61\u7684\u7ed1\u5b9a\uff0c\u53ea\u6709\u4e00\u5c42 json path \u7684\u5bf9\u8c61\uff0c\u53ef\u4ee5\u57fa\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"syncer")," \u5bf9\u8c61\u83b7\u53d6\u5177\u4f53\u7684\u6570\u636e\u540c\u6b65\u5668\u6765\u76f4\u63a5\u4fee\u6539\u8868\u5355\u6570\u636e\uff0c\u8fbe\u5230",(0,l.kt)("strong",{parentName:"p"},"\u53cc\u5411\u7ed1\u5b9a"),"\u7684\u6548\u679c\uff01"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"const [numState, setState, { syncer }] = share({ a: 1, b: { b1: 1 } });\n\n<input value={state.a} onChange={syncer.a} />;\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"syncer"),"\u4f1a\u81ea\u52a8\u5206\u4eab\u662f\u5426\u662f\u4e8b\u4ef6\u5bf9\u8c61\uff0c\u662f\u5c31\u63d0\u53d6\u503c\u4e0d\u662f\u5c31\u76f4\u63a5\u4f20\u503c\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u7ed1\u5b9a ui \u7ec4\u4ef6\u5e93"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"<Select value={ctx.syncer.a} />\n")),(0,l.kt)("p",null,"\u6709\u591a\u5c42\u7ea7 json path \u7684\u5bf9\u8c61\uff0c\u6216\u9700\u8981\u5bf9\u63d0\u4ea4\u8349\u7a3f\u505a\u4e8c\u6b21\u4fee\u6539\u7684\u60c5\u51b5\uff0c\u53ef\u57fa\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"sync")," \u51fd\u6570\u53bb\u64cd\u4f5c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"// \u6570\u636e\u81ea\u52a8\u540c\u6b65\u5230 to.b.b1 \u4e0b\uff0c\n<Select onChange={ctx.sync(to=> to.b.b1)} value={to.b.b1} />\n\n// \u5bf9\u63d0\u4ea4\u4f5c\u62e6\u622a\u64cd\u4f5c\n<Select\n  onChange={ctx.sync(to=> to.b.b1, (val, draft)=> { to.b.b1.time = `${b}_${Date.now()}` } )}\n  value={to.b.b1}\n/>\n")),(0,l.kt)("admonition",{title:"\u540c\u6b65\u51fd\u6570\u81ea\u52a8\u7f13\u5b58",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u591a\u6b21\u8c03\u7528\u6307\u5b9a\u4e86\u540c\u4e00\u4e2a\u8def\u5f84\u65f6\u8fd4\u56de\u7684\u540c\u6b65\u51fd\u6570\uff0c\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\uff1a",(0,l.kt)("br",{parentName:"p"}),"\n",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.sync(to=> to.b.b1) === ctx.sync(to=> to.b.b1)"))),(0,l.kt)("h2",{id:"watch-\u76d1\u542c"},"watch \u76d1\u542c"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helux"),"\u5728\u5185\u90e8\u4e3a\u5b9e\u73b0\u66f4\u667a\u80fd\u7684\u81ea\u52a8\u89c2\u5bdf\u53d8\u5316\u505a\u4e86\u5927\u91cf\u4f18\u5316\u5de5\u4f5c\uff0c\u540c\u65f6\u4e5f\u66b4\u9732\u4e86\u76f8\u5173\u63a5\u53e3\u652f\u6301\u7528\u6237\u5728\u4e00\u4e9b\u7279\u6b8a\u573a\u666f\u505a\u4eba\u5de5\u7684\u89c2\u5bdf\u53d8\u5316\u3002"),(0,l.kt)("h3",{id:"\u7ec4\u4ef6\u5916\u89c2\u5bdf\u53d8\u5316"},"\u7ec4\u4ef6\u5916\u89c2\u5bdf\u53d8\u5316"),(0,l.kt)("p",null,"\u89c2\u5bdf\u51fd\u6570\u7acb\u5373\u6267\u884c\uff0c\u6536\u96c6\u5230\u76f8\u5173\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { share, watch, getSnap } from 'helux';\n\nconst [priceState, setPrice] = share({ a: 1 });\n\nwatch(\n  () => {\n    // \u9996\u6b21\u6267\u884c\u65e5\u5fd7\u5982\u4e0b\n    // price change from 1 to 1\n    //\n    // \u53cd\u590d\u8c03\u7528 changePrice\uff0c\u65e5\u5fd7\u53d8\u5316\u5982\u4e0b\n    // price change from 1 to 101\n    // price change from 101 to 201\n    console.log(`price change from ${getSnap(priceState).a} to ${priceState.a}`);\n  },\n  { immediate: true },\n);\n\nconst changePrice = () =>\n  setPrice((draft) => {\n    draft.a += 100;\n  });\n")),(0,l.kt)("p",null,"\u89c2\u5bdf\u51fd\u6570\u4e0d\u7acb\u5373\u6267\u884c\uff0c\u901a\u8fc7 deps \u51fd\u6570\u5b9a\u4e49\u9700\u8981\u89c2\u5bdf\u7684\u6570\u636e\uff0c\u89c2\u5bdf\u7684\u7c92\u5ea6\u53ef\u4ee5\u4efb\u610f\u5b9a\u5236"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [priceState, setPrice] = share({ a: 1 });\nconst [numAtom, setNum] = atom(3000);\n\n//\nwatch(\n  () => {\n    console.log(`found price.a changed: () => [priceState.a]`);\n  },\n  () => [priceState.a],\n); // \u6216\u5199\u4e3a { deps: () => [priceState.a]  }\n\n// \u89c2\u5bdf\u6574\u4e2a priceState \u7684\u53d8\u5316\nwatch(\n  () => {\n    console.log(`found price changed: [ priceState ]`);\n  },\n  () => [priceState],\n);\n\n// \u89c2\u5bdf\u6574\u4e2a priceState \u548c numAtom \u7684\u53d8\u5316\nwatch(\n  () => {\n    console.log(`found price or numAtom changed: ()=>[ priceState, numAtom ]`);\n  },\n  () => [priceState, numAtom],\n);\n")),(0,l.kt)("p",null,"\u5373\u8bbe\u7f6e\u4f9d\u8d56\u51fd\u6570\u4e5f\u8bbe\u7f6e\u7acb\u5373\u6267\u884c\uff0c\u6b64\u65f6\u7684\u4f9d\u8d56\u7531 ",(0,l.kt)("inlineCode",{parentName:"p"},"deps")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"watch")," \u5171\u540c\u6536\u96c6\u5230\u5e76\u5408\u5e76\u800c\u5f97\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"watch(\n  () => {\n    const { a } = priceState;\n    console.log(`found one of them changed: [ priceState.a, numAtom ]`);\n  },\n  { deps: () => [numAtom], immediate: true },\n);\n")),(0,l.kt)("h3",{id:"\u7ec4\u4ef6\u5185\u89c2\u5bdf\u53d8\u5316"},"\u7ec4\u4ef6\u5185\u89c2\u5bdf\u53d8\u5316"),(0,l.kt)("p",null,"\u63d0\u4f9b",(0,l.kt)("inlineCode",{parentName:"p"},"useWatch"),"\u8ba9\u5ba2\u6237\u5728\u7ec4\u4ef6\u5185\u90e8\u89c2\u5bdf\u53d8\u5316\uff0c\u9884\u5907\u6709\u4ee5\u4e0b\u4e24\u4e2a\u7279\u6027"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u7ec4\u4ef6\u9500\u6bc1\u81ea\u52a8\u53d6\u6d88\u89c2\u5bdf\u884c\u4e3a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { useWatch } from 'helux';\n\nfunction Comp(props: any) {\n  // watch \u56de\u8c03\u968f\u7ec4\u4ef6\u9500\u6bc1\u4f1a\u81ea\u52a8\u53d6\u6d88\u76d1\u542c\n  useWatch(\n    () => {\n      console.log('priceState.a changed');\n    },\n    () => [priceState.a],\n  );\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u65e0\u95ed\u5305\u9677\u9631\uff0c\u603b\u80fd\u611f\u77e5\u95ed\u5305\u5916\u7684\u6700\u65b0\u503c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"function Comp(props: any) {\n  const [obj, setObj] = useObject({ num: 1 });\n  useWatch(\n    () => {\n      console.log('sharedState.a changed, here can read the latest num', obj.num);\n    },\n    () => [sharedState.a],\n  );\n\n  return (\n    <MarkUpdate>\n      <button onClick={() => setObj({ num: random() })}>change local num</button>\n      <div> num is {obj.num}</div>\n      shared.xxx {$(sharedState.a)}\n    </MarkUpdate>\n  );\n}\n")),(0,l.kt)("h2",{id:"\u4f9d\u8d56\u6536\u96c6"},"\u4f9d\u8d56\u6536\u96c6"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helux"),"\u5bf9\u5171\u4eab\u5bf9\u8c61\u5b9e\u73b0\u4e86\u4f9d\u8d56\u6536\u96c6\u529f\u80fd\uff0c\u53ef\u505a\u5230\u66f4\u7cbe\u51c6\u7684\u91cd\u6e32\u67d3\uff0c\u4e0a\u6587\u91cc\u63d0\u5230",(0,l.kt)("inlineCode",{parentName:"p"},"signal"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"block"),"\u5185\u90e8\u5b9e\u73b0\u672c\u8eab\u4e5f\u4f9d\u8d56\u5230\u4e86\u6b64\u529f\u80fd"),(0,l.kt)("h3",{id:"\u666e\u901a\u5bf9\u8c61"},"\u666e\u901a\u5bf9\u8c61"),(0,l.kt)("p",null,"\u7ec4\u4ef6\u5728\u6e32\u67d3\u51fd\u6570\u91cc\u8bfb\u53d6\u5bf9\u8c61\u65f6\u7684\u5177\u4f53\u503c\u65f6\uff0c\u5c31\u6536\u96c6\u5230\u4e86\u6570\u636e\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"const [obj, setState] = share({ a: 1, b: { b1: 2 }, c: 100 });\n\nfunction change() {\n  // \u57fa\u4e8e\u8349\u7a3f\u4fee\u6539\uff0c\u56de\u8c03\u6267\u884c\u7ed3\u675f\u540e\uff0c\u5185\u90e8\u4f1a\u751f\u6210\u4e00\u4efd\u7ed3\u6784\u5171\u4eab\u7279\u6027\u7684\u65b0\u72b6\u6001\n  // \u5f53\u524d\u4fee\u6539\u53ea\u4f1a\u5f15\u8d77\u4e0b\u9762\u7684 Comp2 \u7ec4\u4ef6\u5b9e\u4f8b\u91cd\u6e32\u67d3\n  setState((draft) => (draft.b.b1 = Math.random()));\n}\n\nfunction Comp1() {\n  const [obj] = userShared(objAtom);\n  // \u5f53\u524d\u7ec4\u4ef6\u4ec5\u5bf9 obj.a \u6709\u4f9d\u8d56\n  return <h1>obj.a {obj.a} </h1>;\n}\n\nfunction Comp2() {\n  const [obj] = userShared(objAtom);\n  // \u5f53\u524d\u7ec4\u4ef6\u4ec5\u5bf9 obj.b.b1 \u6709\u4f9d\u8d56\n  return <h1>obj.b.b1 {obj.b.b1} </h1>;\n}\n")),(0,l.kt)("h3",{id:"\u6570\u7ec4\u5bf9\u8c61"},"\u6570\u7ec4\u5bf9\u8c61"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u6570\u7ec4\u7ed3\u6784\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u53ea\u8ffd\u8e2a\u5230\u4e0b\u6807\u4f4d\u7f6e\uff0c\u53ef\u914d\u5408\u5de5\u5177\u51fd\u6570",(0,l.kt)("inlineCode",{parentName:"p"},"shallowCompare"),"\u505a\u7cbe\u51c6\u6e32\u67d3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"import { atom, shallowCompare, useAtom } from 'helux';\n// \u56e0 share \u76f4\u63a5\u53d7 object \u6570\u636e\uff0c\u6b64\u5904\u523b\u610f\u7528 atom\nconst [listAtom, setAtom] = atom([\n  { id: 1, name: 11 },\n  { id: 2, name: 22 },\n]);\n\nfunction change(idx: number) {\n  // \u5f53\u524d\u4fee\u6539\u4ec5\u4f1a\u5f15\u8d77 List \u548c Item1 \u91cd\u6e32\u67d3\n  setAtom((draft) => {\n    draft[idx].name = Date.now();\n  });\n}\n\nconst Item = React.memo((props) => {\n  const { item } = props;\n  return (\n    <div>\n      id: {item.id} name: {item.name}\n    </div>\n  );\n  // \u900f\u4f20 shallowCompare \u51fd\u6570\uff0c\u7528\u4e8e\u6bd4\u8f83item\u4ee3\u7406\u5bf9\u8c61\u524d\u540e\u662f\u5426\u4e00\u81f4\uff0c\u5185\u90e8\u4f1a\u6bd4\u8f83\u6570\u636e\u7248\u672c\u53f7\n}, shallowCompare);\n\nfunction List() {\n  const [list] = useAtom(listAtom);\n  return (\n    <div>\n      <button onClick={() => change(1)}>change idx 1</button>\n      <div>\n        {list.map((item) => (\n          <Item key={item.id} item={item} />\n        ))}\n      </div>\n    </div>\n  );\n}\n")),(0,l.kt)("h3",{id:"\u52a8\u6001\u4f9d\u8d56\u6536\u96c6"},"\u52a8\u6001\u4f9d\u8d56\u6536\u96c6"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helux"),"\u9ed8\u8ba4\u5bf9\u7ec4\u4ef6\u5f00\u542f\u52a8\u6001\u7684\u4f9d\u8d56\u6536\u96c6\u884c\u4e3a\uff0c\u53ef\u5b9e\u65f6\u6536\u96c6\u5230\u7ec4\u4ef6\u5b9e\u4f8b\u7684\u6bcf\u4e00\u8f6e\u6e32\u67d3\u6240\u9700\u4f9d\u8d56\uff0c\u505a\u5230\u66f4\u667a\u80fd\u7684\u7cbe\u786e\u66f4\u65b0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"const [obj, setState] = share({ a: 1, b: { b1: 2 }, c: 100 });\n\nfunction Comp1() {\n  const [obj] = userShared(objAtom);\n  // \u5728 obj.a>10 \u65f6\uff0c\u5f53\u524d\u7ec4\u4ef6\u4f9d\u8d56\u65f6 obj.a\uff0cobj.b.b1\n  // \u53cd\u4e4b\u5219\u662f obj.a\uff0cobj.c\n  return <h1>dynamic dep colletion {obj.a > 10 ? obj.b.b1 : obj.c} </h1>;\n}\n")),(0,l.kt)("p",null,"\u5982\u4e0d\u9700\u8981\uff0c\u53ef\u8bbe\u7f6e",(0,l.kt)("inlineCode",{parentName:"p"},"collectionType"),"\u4e3a\u4ec5\u9996\u8f6e\u6e32\u67d3\u9700\u8981\u6536\u96c6\u4f9d\u8d56\uff0c\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6e32\u67d3\u6027\u80fd"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"useShared(shared, { collectionType: 'first' });\n\nuseAtom(numAtom, { collectionType: 'first' });\n")),(0,l.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u6536\u96c6\u89c4\u5219"},"\u81ea\u5b9a\u4e49\u6536\u96c6\u89c4\u5219"),(0,l.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bf9\u8c61\u7684\u4f9d\u8d56\u6536\u96c6\u7684\u6df1\u5ea6\u503c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"6"),"\uff0c\u5728\u4e0d\u8d85\u8fc7\u6df1\u5ea6\u503c\u7684\u60c5\u51b5\u4e0b\uff0c\u9488\u5bf9\u6570\u7ec4\u53ea\u6536\u96c6\u5230\u4e0b\u6807\u4f4d\u7f6e\uff0c\u53ef\u901a\u8fc7\u914d\u7f6e\u4f9d\u8d56\u6536\u96c6\u89c4\u5219\u6765\u6539\u53d8\u9ed8\u8ba4\u7684\u6536\u96c6\u7b56\u7565"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"stopDepth")," \u63a7\u5236\u4f9d\u8d56\u6536\u96c6\u6df1\u5ea6\uff0c\u9ed8\u8ba4",(0,l.kt)("inlineCode",{parentName:"li"},"6")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"stopArrDep")," \u63a7\u5236\u6570\u7ec4\u662f\u5426\u53ea\u6536\u96c6\u5230\u4e0b\u6807\u4f4d\u7f6e\uff0c\u9ed8\u8ba4 ",(0,l.kt)("inlineCode",{parentName:"li"},"true"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [state, setState, ctx] = share(\n  {\n    a: {\n      b: {\n        list: [\n          { name: 1, age: 2, info: { street: 'u_road' } },\n          { name: 2, age: 22, info: { street: 'u_road_2' } },\n        ],\n      },\n    },\n    a1: { a2: { a3: { a4: { a5: { a6: { a7: { a8: 1 } } } } } } },\n  },\n  {\n    stopDepth: 12, // \u6539\u4e3a 12\n    stopArrDep: false, // \u5bf9\u8c61\u91cc\u7684\u6240\u6709\u6570\u7ec4\u90fd\u7ee7\u7eed\u5411\u4e0b\u6536\u96c6\uff08\u5373\u5173\u95ed\u53ea\u6536\u96c6\u5230\u4e0b\u6807\u4f4d\u7f6e\u89c4\u5219\uff09\n  },\n);\n")),(0,l.kt)("p",null,"\u53ef\u9488\u5bf9\u72b6\u6001\u67d0\u4e9b\u8282\u70b9\u8bbe\u7f6e\u6536\u96c6\u89c4\u5219"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [state, setState, ctx] = share({ ... }, {\n  rules: [\n    // \u5f53\u8bfb\u53d6\u6216\u5199\u5165 a.b.list \u6570\u636e\u65f6\uff0c\u505c\u6b62\u4f9d\u8d56\u6536\u96c6\uff0c\u5373\u4f9d\u8d56\u53ea\u8bb0\u5f55\u5230\u4e0b\u6807\uff0c\u6b64\u8bbe\u5b9a\u4f18\u5148\u7ea7\u9ad8\u4e8e\u9876\u5c42\u7684 stopArrDep\n    { when: state => state.a.b.list, stopDep: true },\n  ],\n  stopArrDep: false, // \u5bf9\u8c61\u91cc\u7684\u6240\u6709\u6570\u7ec4\u90fd\u7ee7\u7eed\u5411\u4e0b\u6536\u96c6\uff08\u5373\u5173\u95ed\u53ea\u6536\u96c6\u5230\u4e0b\u6807\u4f4d\u7f6e\u89c4\u5219\uff09\n});\n")),(0,l.kt)("h2",{id:"\u53ef\u53d8\u6d3e\u751f"},"\u53ef\u53d8\u6d3e\u751f"),(0,l.kt)("p",null,"\u7531\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"atom")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"share")," \u8fd4\u56de\u7684\u5bf9\u8c61\u5929\u751f\u81ea\u5e26\u4f9d\u8d56\u8ffd\u8e2a\u7279\u6027\uff0c\u5f53\u5171\u4eab\u5bf9\u8c61 a \u7684\u53d1\u751f\u53d8\u5316\u540e\u9700\u8981\u81ea\u52a8\u5f15\u8d77\u5171\u4eab\u72b6\u6001 b \u7684\u67d0\u4e9b\u8282\u70b9\u53d8\u5316\u65f6\uff0c\u53ef\u5b9a\u4e49 ",(0,l.kt)("inlineCode",{parentName:"p"},"mutate")," \u51fd\u6570\u6765\u5b8c\u6210\u8fd9\u79cd\u53d8\u5316\u7684\u8fde\u9501\u53cd\u5e94\u5173\u7cfb\uff0c\u5bf9\u6570\u636e\u505a\u6700\u5c0f\u7c92\u5ea6\u7684\u66f4\u65b0"),(0,l.kt)("h3",{id:"\u5355\u53d8\u5316\u51fd\u6570"},"\u5355\u53d8\u5316\u51fd\u6570"),(0,l.kt)("p",null,"\u53ea\u4fee\u6539\u5171\u4eab\u72b6\u6001\u7684\u5355\u4e2a\u503c\u65f6\uff0c\u5b9a\u4e49\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"mutate")," \u51fd\u6570\u5373\u53ef"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [numAtom] = atom(3000);\n\nconst [finalPriceState] = share(\n  { finalPrice: 0, otherInfo: { desc: 'other' } },\n  {\n    // \u5f53 numAtom \u53d8\u5316\u65f6\uff0c\u91cd\u8ba1\u7b97 finalPrice \u8282\u70b9\u7684\u503c\n    mutate: (draft) => (draft.finalPrice = numAtom.val - 600),\n  },\n);\n")),(0,l.kt)("h3",{id:"\u591a\u53d8\u5316\u51fd\u6570"},"\u591a\u53d8\u5316\u51fd\u6570"),(0,l.kt)("p",null,"\u9700\u8981\u54cd\u5e94\u591a\u4e2a\u4e0d\u540c\u4e0a\u6e38\u72b6\u6001\u7684\u503c\u53d8\u5316\uff0c\u8ba1\u7b97\u591a\u4e2a\u8282\u70b9\u65b0\u503c\u65f6\uff0c\u5b9a\u4e49 ",(0,l.kt)("inlineCode",{parentName:"p"},"mutate")," \u4e3a\u5bf9\u8c61\u5373\u53ef"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"const [priceState] = share({ base1: 1, base2: { forStudent: 1, forTeacher: 2 } });\nconst [finalPriceState] = share(\n  // \u8fd9\u91cc\u4ec5\u8d1f\u8d23\u5b9a\u4e49\u521d\u59cb\u503c\uff0c\u53d8\u5316\u89c4\u5219\u89c1 options.mutate \u5b9a\u4e49\n  { final1: 0, final2: { student: 0, teacher: 0 } },\n  {\n    // \u5b9a\u4e49 mutate \u914d\u7f6e\uff0c\u5b8c\u6210\u76f8\u5173\u7684\u6570\u636e\u53d8\u5316\u76d1\u542c\u548c\u4fee\u6539\u51fd\u6570\u5b9a\u4e49\uff0c\u540d\u5b57\u53ef\u6309\u573a\u666f\u5b9a\u4e49\uff0c\u65b9\u4fbf\u914d\u5408 devtool \u5de5\u5177\u505a\u53d8\u5316\u8ffd\u8e2a\n    mutate: {\n      // \u4ec5\u5f53 priceState \u7684 base1 \u53d8\u5316\u65f6\uff0c\u8ba1\u7b97 finalAtom \u7684 final1 \u503c\n      changeFinal1: (draft) => (draft.final1 = priceState.base1 + 20),\n      // \u4ec5\u5f53 priceState \u7684 base2.forStudent \u53d8\u5316\u65f6\uff0c\u8ba1\u7b97 finalAtom \u7684 final2.student \u503c\n      changeFinal2: (draft) => (draft.final2.student = priceState.base2.forStudent + 100),\n    },\n  },\n);\n\nfunction Demo() {\n  const [final] = useAtom(finalPriceState);\n  // \u5f53 priceState \u7684 base1 \u53d8\u5316\u540e\uff0c\u4f1a\u6b64\u5904\u91cd\u6e32\u67d3\n  return <h1>final.final2.student {final.final2.student}</h1>;\n}\n")),(0,l.kt)("p",null,"\u4e5f\u53ef\u5b9a\u4e49 ",(0,l.kt)("inlineCode",{parentName:"p"},"mutate")," \u4e3a\u6570\u7ec4"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  mutate: [\n    { desc: 'changeFinal1', fn: (draft) => (draft.final1 = priceState.base1 + 20) },\n    { desc: 'changeFinal2', fn: (draft) => (draft.final2.student = priceState.base2.forStudent + 100) },\n  ];\n}\n")),(0,l.kt)("h3",{id:"\u5f02\u6b65\u6d3e\u751f\u51fd\u6570"},"\u5f02\u6b65\u6d3e\u751f\u51fd\u6570"),(0,l.kt)("p",null,"\u5982\u5b58\u5728\u5f02\u6b65\u7684\u8ba1\u7b97\u573a\u666f\uff0c\u5bf9 ",(0,l.kt)("inlineCode",{parentName:"p"},"mutate")," \u51fd\u6570\u65b0\u589e ",(0,l.kt)("inlineCode",{parentName:"p"},"task")," \u5f02\u6b65\u8ba1\u7b97\u51fd\u6570\u914d\u7f6e\u5373\u53ef\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u9996\u6b21\u8ba1\u7b97\u7ed3\u679c\u4e0d\u9700\u8981\u5f02\u6b65\u4efb\u52a1\u624d\u80fd\u5f97\u51fa\u65f6\uff0c\u4f9d\u8d56\u53ef\u5728 fn \u91cc\u786e\u5b9a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [finalPriceState] = share(\n  { retA: 0, time: 0 },\n  {\n    mutate: {\n      retA: {\n        // \u8ba1\u7b97\u51fa retA \u503c\u5e76\u5199\u5165\n        fn: (draft, [a, b]) => (draft.retA = priceState.a + numAtom.val),\n        task: async ({ setState }) => {\n          // \u9ed8\u8ba4\u9996\u6b21\u4e0d\u6267\u884c\n          await delay(1000);\n          // some async logic here ...\n          setState((draft) => {\n            draft.retA = priceState.a + numAtom.val;\n          });\n        },\n      },\n    },\n  },\n);\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u9996\u6b21\u8ba1\u7b97\u7ed3\u679c\u9700\u8981\u5f02\u6b65\u4efb\u52a1\u624d\u80fd\u5f97\u51fa\u65f6\uff0c\u4f9d\u8d56\u53ef\u5728 deps \u91cc\u786e\u5b9a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [finalPriceState] = share({ retA: 0, time: 0 }, {\n  mutate: {\n    retA: {\n      // \u5b9a\u4e49\u597d\u4e0a\u6e38\u6570\u636e\u4f9d\u8d56\n      deps: [priceState.a , numAtom.val],\n      task: async ({ setState }) => { ... },\n    },\n  },\n});\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"deps\u3001fn \u3001task \u53ef\u540c\u65f6\u5b9a\u4e49\uff0c\u5b58\u5728\u6709 task \u7684\u60c5\u51b5\u4e0b\uff0c fn \u53ea\u4f1a\u9996\u6b21\u6267\u884c\u4e00\u6b21\uff0ctask \u8981\u4e0d\u8981\u6267\u884c\u53d6\u51b3\u4e8e immediate \u503c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [finalPriceState] = share({ retA: 0, time: 0 }, {\n  mutate: {\n    retA: {\n      // \u5b9a\u4e49\u597d\u4e0a\u6e38\u6570\u636e\u4f9d\u8d56\n      deps: [priceState.a , numAtom.val],\n      // \u8fd9\u91cc\u901a\u8fc7\u7b2c\u4e8c\u4f4d\u53c2\u6570 input \u53ef\u62ff\u5230 deps \u7684\u8fd4\u56de\u503c\u5e76\u590d\u7528\n      fn: (draft, [a, b]) => draft.retA = a + b,\n      task: async ({ setState }) => { ... },\n      immediate: true,\n    },\n  },\n});\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"mutate"),"\u7684\u5f02\u6b65\u6d3e\u751f\u51fd\u6570\u4e5f\u53ef\u5199\u4e3a\u6570\u7ec4\uff0c\u6570\u7ec4\u91cc\u53ef\u540c\u65f6\u5305\u542b\u540c\u6b65\u8ba1\u7b97\u51fd\u6570\u3001\u5f02\u6b65\u8ba1\u7b97\u51fd\u6570\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [finalPriceState] = share({ retA: 0, time: 0 }, {\n  mutate: [ { fn, desc, task, immediate }, ... ]\n});\n")),(0,l.kt)("h3",{id:"\u5916\u90e8\u5b9a\u4e49\u53ef\u53d8\u6d3e\u751f"},"\u5916\u90e8\u5b9a\u4e49\u53ef\u53d8\u6d3e\u751f"),(0,l.kt)("p",null,"\u4e0a\u8ff0\u4f8b\u5b50\u90fd\u662f\u5728\u5b9a\u4e49",(0,l.kt)("inlineCode",{parentName:"p"},"share"),"\u6216",(0,l.kt)("inlineCode",{parentName:"p"},"atom"),"\u5171\u4eab\u5bf9\u8c61\u65f6\u540c\u65f6\u5b9a\u4e49\u7684\u53ef\u53d8\u6d3e\u751f\u51fd\u6570\uff0c\u4e5f\u53ef\u5148\u5b9a\u4e49\u5171\u4eab\u5bf9\u8c61\uff0c\u518d\u901a\u8fc7\u9876\u5c42 api ",(0,l.kt)("inlineCode",{parentName:"p"},"mutate")," \u6216\u5171\u4eab\u5bf9\u8c61\u4e0a\u4e0b\u6587 api ",(0,l.kt)("inlineCode",{parentName:"p"},"mutate")," \u5bf9\u5171\u4eab\u5bf9\u8c61\u5b9a\u4e49",(0,l.kt)("strong",{parentName:"p"},"\u53ef\u53d8\u6d3e\u751f")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u9876\u5c42 api \u5b9a\u4e49",(0,l.kt)("strong",{parentName:"li"},"\u53ef\u53d8\u6d3e\u751f"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { atomMutate, atom, share, mutate } from 'helux';\n\nconst [baseAtom] = atom(1);\nconst [numAtom] = atom(3000);\nconst [obj] = share({ a: 1 });\n\n// \u4e3a atom \u5bf9\u8c61\u521b\u5efa mutate \u51fd\u6570\natomMutate(numAtom)({\n  fn: () => baseAtom.val + 100,\n  desc: 'mutateNumAtomVal',\n});\n\n// \u4e3a shared \u5bf9\u8c61\u521b\u5efa mutate \u51fd\u6570\nmutate(obj)({\n  fn: (draft) => (draft.a = baseAtom.val + 100),\n  desc: 'mutateObjVal',\n});\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u5171\u4eab\u5bf9\u8c61\u4e0a\u4e0b\u6587 api \u5b9a\u4e49",(0,l.kt)("strong",{parentName:"li"},"\u53ef\u53d8\u6d3e\u751f"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [numAtom, , numCtx] = atom(3000); // \u8fd4\u56de\u5143\u7ec4\u4e3a [ atom, setAtom, ctx ]\nconst [obj, , objCtx] = share({ a: 1 }); // \u8fd4\u56de\u5143\u7ec4\u4e3a [ shared, setState, ctx ]\n\n// \u4f20\u5165\u7684\u53c2\u6570\u4e00\u6837\uff0c\u76f8\u6bd4\u9876\u5c42 api\uff0c\u5c11\u4e86\u4e00\u6b21\u5171\u4eab\u5bf9\u8c61\u7684\u7ed1\u5b9a\n// before: mutate(sharedState)(fnItem)\n// after:  ctx.mutate(fnItem)\nctx.mutate({ ... });\nobjCtx.mutate({ ... });\n")),(0,l.kt)("h3",{id:"\u4eba\u5de5\u89e6\u53d1\u91cd\u8fd0\u884c"},"\u4eba\u5de5\u89e6\u53d1\u91cd\u8fd0\u884c"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"mutate"),"\u51fd\u6570\u9ed8\u8ba4\u8fd0\u884c\u65f6\u673a\u662f\u57fa\u4e8e\u76d1\u542c\u7684\u6570\u636e\u53d8\u66f4\u540e\u88ab\u89e6\u53d1\u8fd0\u884c\u7684\uff0c\u4e5f\u652f\u6301\u4eba\u5de5\u8c03\u7528\u7684\u65b9\u5f0f\u4e3b\u52a8\u89e6\u53d1\u91cd\u8fd0\u884c"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u89e6\u53d1\u53ef\u53d8\u6d3e\u751f\u51fd\u6570\u91cd\u8fd0\u884c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { runMutate, runMutateTask } from 'helux';\n\n// \u89e6\u53d1 someState \u7684 retA mutate \u914d\u7f6e\u7684\u540c\u6b65\u51fd\u6570\nrunMutate(someState, 'retA');\n\n// \u89e6\u53d1 someState \u7684 retA mutate \u914d\u7f6e\u7684\u5f02\u6b65\u51fd\u6570\nrunMutateTask(someState, 'retA');\n")),(0,l.kt)("p",null,"\u4e5f\u53ef\u4ee5\u57fa\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"mutate"),"\u63a5\u53e3\u8fd4\u56de\u7684\u5bf9\u8c61\u89e6\u53d1\u91cd\u8fd0\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const witness = mutate(idealPriceState)(fnItem);\n\n// \u547c\u53eb fnItem \u914d\u7f6e\u7684\u540c\u6b65\u51fd\u6570\nwitness.call();\n// \u547c\u53eb fnItem \u914d\u7f6e\u7684\u5f02\u6b65\u51fd\u6570\nwitness.callTask();\n")),(0,l.kt)("h2",{id:"\u5168\u91cf\u6d3e\u751f"},"\u5168\u91cf\u6d3e\u751f"),(0,l.kt)("p",null,"\u4e0d\u9700\u8981\u7ec6\u7c92\u5ea6\u66f4\u65b0\u6d3e\u751f\u6570\u636e\u7684\u573a\u666f\uff0c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"derive")," \u7cfb\u5217\u63a5\u53e3\u5373\u53ef\uff0c\u8be5\u63a5\u53e3\u63a5\u53d7\u4e00\u4e2a\u6d3e\u751f\u51fd\u6570\u5b9e\u73b0\uff0c\u8fd4\u56de\u4e00\u4e2a\u5168\u65b0\u7684\u6d3e\u751f\u503c\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u662f\u4e00\u4e2a\u53ea\u53ef\u8bfb\u7684\u7a33\u5b9a\u5f15\u7528\uff0c\u5168\u5c40\u4f7f\u7528\u53ef\u603b\u662f\u8bfb\u53d6\u5230\u6700\u65b0\u503c\u3002"),(0,l.kt)("h3",{id:"\u540c\u6b65\u5168\u91cf\u6d3e\u751f"},"\u540c\u6b65\u5168\u91cf\u6d3e\u751f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { atom, share, derive, driveAtom } from 'helux';\n\nconst [numAtom] = atom(5);\nconst [info] = share({ a: 50, c: { c1: 100, c2: 1000 }, list: [{ name: 'one', age: 1 }] });\n\n// \u6d3e\u751f\u8fd4\u56de\u5bf9\u8c61\uff0c\u6d3e\u751f\u51fd\u6570\u9996\u6b21\u8fd0\u884c\u540e\uff0c\u4ec5\u5728 numAtom.va \u6216 info.c.c1 \u53d1\u751f\u53d8\u5316\u540e\u624d\u4f1a\u91cd\u8fd0\u884c\u8ba1\u7b97\u51fa\u65b0\u7684 result\nconst result = derive(() => {\n  return { val: numAtom.val + info.c.c1 };\n});\n\n// driveAtom \u8fd4\u56de\u539f\u59cb\u503c\uff0cresult \u4f1a\u81ea\u52a8\u88c5\u7bb1\u4e3a { val: T }\nconst result = driveAtom(() => {\n  return numAtom.val + info.c.c1;\n});\n")),(0,l.kt)("h3",{id:"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f"},"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f"),(0,l.kt)("p",null,"\u652f\u6301\u914d\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"task")," \u5f02\u6b65\u8ba1\u7b97\u4efb\u52a1\u6765\u5b9e\u73b0\u5f02\u6b65\u6d3e\u751f\u7ed3\u679c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [sharedState, setState] = share({ a: 1, b: { b1: { b2: 200 } } });\n\nconst result = deriveAsync({\n  // \u5b9a\u4e49\u4f9d\u8d56\u9879\n  deps: () => [sharedState.a, sharedState.b.b1.b2] as const,\n  // \u5b9a\u4e49\u521d\u59cb\u503c\u8ba1\u7b97\u51fd\u6570\n  fn: ({ input: [a, b2] }) => ({ val: a + b2 }),\n  // \u5b9a\u4e49\u5f02\u6b65\u8ba1\u7b97\u4efb\u52a1\uff0c\u9ed8\u8ba4\u9996\u6b21\u4e0d\u6267\u884c\uff0c\u53ef\u8bbe\u7f6e immediate \u89e6\u53d1\u9996\u6b21\u6267\u884c\n  task: async ({ input: [a, b2] }) => {\n    await delay(1000);\n    return { val: a + b2 + 1 };\n  },\n  // immediate: true,\n});\n\n// \u53ef\u4f7f\u7528 deriveAtomAsync \u5b9a\u4e49\u5f02\u6b65\u8ba1\u7b97\u4efb\u52a1\u5e76\u8fd4\u56de\u539f\u59cb\u503c\n// const resultAtom = deriveAtomAsync();\n")),(0,l.kt)("p",null,"\u6d3e\u751f\u7ed3\u679c\u662f\u652f\u6301\u590d\u7528\uff0c\u5f62\u6210\u6d3e\u751f\u94fe"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"// \u4ee5\u4e0b\u4e3a\u4f2a\u4ee3\u7801\nconst result1 = derive(...);\nconst result2 = driveAtom(...);\nconst result3 = deriveAsync(...);\n\nconst result4 = derive(()=>{\n  return { num: result.a + 1, plus: result2.val + 100, final: result3.num + 100 };\n});\n")),(0,l.kt)("h3",{id:"\u7ec4\u4ef6\u4f7f\u7528\u5168\u91cf\u6d3e\u751f\u7ed3\u679c"},"\u7ec4\u4ef6\u4f7f\u7528\u5168\u91cf\u6d3e\u751f\u7ed3\u679c"),(0,l.kt)("p",null,"\u7ec4\u4ef6\u5185\u90e8\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"useDerived"),"\u94a9\u5b50\u51fd\u6570\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"derive"),"\u6d3e\u751f\u7ed3\u679c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"const result1 = derive(...);\n\nfunction Demo(){\n  const [ result ] = useDerived(result1);\n}\n")),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"useDerivedAtom"),"\u94a9\u5b50\u51fd\u6570\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"driveAtom"),"\u6d3e\u751f\u7ed3\u679c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"const resultAtom = driveAtom(...);\n\nfunction Demo(){\n  // reulst \u4f1a\u88ab\u81ea\u52a8\u4ece { val: T } \u62c6\u7bb1\u4e3a T\n  const [ result ] = useDerivedAtom(resultAtom);\n}\n")),(0,l.kt)("h3",{id:"\u4eba\u5de5\u89e6\u53d1\u91cd\u8fd0\u884c-1"},"\u4eba\u5de5\u89e6\u53d1\u91cd\u8fd0\u884c"),(0,l.kt)("p",null,"\u6d3e\u751f\u51fd\u6570\u9664\u4e86\u89c2\u5bdf\u5230\u6570\u636e\u4f9d\u8d56\u53d8\u5316\u540e\u88ab\u89e6\u53d1\u6267\u884c\u7684\u65b9\u5f0f\uff0c\u8fd8\u53ef\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"runDerive")," \u63a5\u53e3\u4eba\u5de5\u89e6\u53d1\u5bf9\u5e94\u7684\u6d3e\u751f\u51fd\u6570"),(0,l.kt)("h2",{id:"loading-\u7ba1\u7406"},"loading \u7ba1\u7406"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helux")," \u4e3a",(0,l.kt)("strong",{parentName:"p"},"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f"),"\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u5f02\u6b65\u53ef\u53d8\u6d3e\u751f"),"\u548c",(0,l.kt)("strong",{parentName:"p"},"\u5f02\u6b65\u52a8\u4f5c\u884c\u4e3a"),"\u5185\u7f6e\u4e86\u4f18\u96c5\u4e14\u5f3a\u5927\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"loading")," \u7ba1\u7406\u673a\u5236\uff0c\u8ba9\u7528\u6237\u53ef\u8f7b\u677e\u5904\u7406\u5f02\u6b65\u6d41\u7a0b 3 \u4e2a\u5173\u952e\u70b9"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u662f\u5426\u6267\u884c\u4e2d"),(0,l.kt)("li",{parentName:"ul"},"\u662f\u5426\u6709\u9519"),(0,l.kt)("li",{parentName:"ul"},"\u662f\u5426\u6b63\u5e38\u5c55\u793a")),(0,l.kt)("p",null,"\u5168\u5c40\u7edf\u4e00\u4f7f\u7528\u6807\u51c6 ",(0,l.kt)("inlineCode",{parentName:"p"},"LoadingStatus")," \u534f\u8bae\u6765\u5904\u7406\u5f02\u6b65\u4efb\u52a1\u6267\u884c\u7ed3\u679c\u5e76\u4f20\u8fbe\u7ed9\u7ec4\u4ef6\u4f7f\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"type LoadingStatus = {\n  /** true\uff1a\u6b63\u5728\u6267\u884c\u5f02\u6b65\u4efb\u52a1\u4e2d */\n  loading: boolean;\n  /** err \u5b58\u5728\u8868\u793a\u6709\u9519\u8bef\u53d1\u751f */\n  err: Error | null;\n  /** ok \u4e3a true \u8868\u793a\u53ef\u6b63\u5e38\u5c55\u793a\u5185\u5bb9\uff0cok=(!loading && !err) */\n  ok: boolean;\n};\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helux"),"\u8fd8\u5bf9",(0,l.kt)("inlineCode",{parentName:"p"},"loading"),"\u505a\u4e86\u5b89\u5168\u8bfb\u53d6\u4f18\u5316\uff0c\u7528\u6237\u4f20\u5165\u4efb\u610f\u5b57\u7b26\u4e32\u5747\u5747\u8fd4\u56de status \u5bf9\u8c61\uff0c\u5bf9\u5e94\u5bf9\u4e8e\u4e0d\u5b58\u5728\u7684 key\uff0c\u8fd4\u56de\u7684 status \u662f\u4e0d\u53d8\u7684"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [loading] = useMutateLoading(); // useActionLoading\nconst ok = loading['whatever-key'].ok; // \u5bf9\u8c61\u53d6\u503c\u64cd\u4f5c\u662f\u6052\u5b89\u5168\u7684\n")),(0,l.kt)("h3",{id:"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f-loading"},"\u5f02\u6b65\u5168\u91cf\u6d3e\u751f loading"),(0,l.kt)("p",null,"\u4f7f\u7528\u94a9\u5b50\u51fd\u6570",(0,l.kt)("inlineCode",{parentName:"p"},"useDerived"),"\u65f6\uff0c\u5982\u679c\u4f20\u5165\u7ed3\u679c\u5bf9\u8c61\u81ea\u8eab\u5e26\u6709\u5f02\u6b65\u8ba1\u7b97\u4efb\u52a1\u6216\u8005\u8be5\u5bf9\u8c61\u7684\u8ba1\u7b97\u7ed3\u679c\u4f9d\u8d56\u6709\u4e0a\u6e38\u5b58\u5728\u6709\u5f02\u6b65\u8ba1\u7b97\u7ed3\u679c\uff0c\u5747\u53ef\u4ece\u7b2c\u4e8c\u4f4d\u53c2\u6570",(0,l.kt)("inlineCode",{parentName:"p"},"status"),"\u83b7\u53d6\u5230\u5f02\u6b65\u72b6\u6001\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-jsx"},"const [sharedState, setState] = share({ a: 1, b: { b1: { b2: 200 } } });\nconst changeA = () => setState(draft => { draft.a = random() });\n\nconst result = deriveAsync({\n  deps: () => [sharedState.a, sharedState.b.b1.b2] as const,\n  fn: () => ({ a: 0, b2: 0 }),\n  task: async ({ input: [a, b2] }) => {\n    await delay(1000);\n    if (a < 80) {\n      throw new Error(`a ${a} < 80`);\n    }\n    return { a: a + 100, b2: b2 + 200 };\n  },\n});\n\nfunction Comp() {\n  const [data, status] = useDerived(result);\n  return (\n    <div>\n      {status.loading && <h1>loading...</h1>}\n      {status.err && <h1 style={{ color: 'red' }}>{status.err.message}</h1>}\n      {status.ok && <h1>{data.a}</h1>}\n    </div>\n  );\n}\n")),(0,l.kt)("h3",{id:"\u5f02\u6b65\u53ef\u53d8\u6d3e\u751f-loading"},"\u5f02\u6b65\u53ef\u53d8\u6d3e\u751f loading"),(0,l.kt)("p",null,"\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"useMutateLoading"),"\u8bfb\u53d6\u53ef\u53d8\u6d3e\u751f\u5f02\u6b65\u4efb\u52a1\u72b6\u6001\uff0c\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u8c03\u7528\u7686\u53ef"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { useMutateLoading, share } from 'helux';\nconst [sharedState, setState, ctx] = share({ a: 1, b: { b1: { b2: 200 } } });\n\n// \u4f7f\u7528\u9876\u5c42 api \u4f20\u5165\u76ee\u6807\u5171\u4eab\u72b6\u6001\uff0c\u8868\u793a\u8981\u4f7f\u7528\u76ee\u6807\u5171\u4eab\u72b6\u6001\u7684 loading \u5bf9\u8c61\nuseMutateLoading(sharedState);\n// \u4f7f\u7528 share \u8fd4\u56de\u7684\u4e0a\u4e0b\u6587\u91cc\u63d0\u4f9b\u7684 useMutateLoading\uff0c\u5185\u90e8\u81ea\u52a8\u7ed1\u5b9a\u4e86\u5bf9\u5e94\u7684\u72b6\u6001\nctx.useMutateLoading();\n")),(0,l.kt)("p",null,"\u5b9a\u4e49 mutate \u51fd\u6570\uff0c\u8bfb\u53d6\u5bf9\u5e94 loading"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"const [sharedState, setState, ctx] = share({ a: 1, b: { b1: { b2: 200 } } });\n\nconst witness = mutate(sharedState)({\n  deps: () => [sharedState.a] as const,\n  task: async ({ setState, input }) => {\n    await delay(2000);\n    setState((draft) => {\n      draft.a += input[0] + random();\n    });\n  },\n  desc: 'mutateFn',\n});\n\nfunction Comp() {\n  const [state] = ctx.useState();\n  const [loading, , info] = ctx.useMutateLoading();\n  const status = loading['mutateFn'];\n\n  return (\n    <div>\n      {status.loading && <h1>loading...</h1>}\n      {status.err && <h1 style={{ color: 'red' }}>{status.err.message}</h1>}\n      {status.ok && <h1>{state.a}</h1>}\n    </div>\n  );\n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"useMutateLoading")," \u4e5f\u80fd\u8bfb\u53d6\u4f34\u968f\u72b6\u6001\u4e00\u8d77\u5b9a\u4e49\u7684 mutate \u51fd\u6570\u7684 status\uff0c\u4e14\u80fd\u611f\u77e5\u5230\u5177\u4f53\u540d\u79f0\u7684\u63d0\u793a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [numAtom] = atom(3000);\nconst [priceState, setPrice] = share({ a: 1, b: 100 }, { moduleName: 'MutateTask' });\nconst [idealPriceState, , ctx] = share(\n  { loading: false, retA: 0, retB: 1 },\n  {\n    moduleName: 'idealPrice',\n    mutate: {\n      retB: (draft) => (draft.retB = priceState.b + 2 + numAtom.val),\n    },\n  },\n);\n\nconst [loading] = ctx.useMutateLoading();\nloading.retB.loading; // \u8fd9\u91ccIDE\u5c06\u63d0\u793a\u51fa loading \u4e0a retB \u6709\u5c5e\u6027\n")),(0,l.kt)("h3",{id:"action-\u51fd\u6570-loading"},"action \u51fd\u6570 loading"),(0,l.kt)("p",null,"\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"action"),"\u5de5\u5382\u5b9a\u4e49\u51fa\u6765\u7684 action \u5f02\u6b65\u51fd\u6570\uff0c\u53ef\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"useActionLoading")," \u94a9\u5b50\u5728\u7ec4\u4ef6\u91cc\u67e5\u8be2"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const [sharedState, setState, ctx] = share({ a: 1, b: { b1: { b2: 200 } } });\n\nconst myAsyncAction = actionAsync(sharedState)(async ({ setState }) => {\n  await delay(2000);\n  setState((draft) => {\n    draft.a += 100;\n  });\n}, 'myAsyncAction');\n\nfunction Comp() {\n  const [loading] = ctx.useActionLoading();\n  console.log(loading['myAsyncAction']);\n\n  return (\n    <MarkUpdate>\n      <h1>{loading['myAsyncAction'].loading && 'loading...'}</h1>\n      shared.xxx {$(sharedState.a)}\n    </MarkUpdate>\n  );\n}\n")),(0,l.kt)("h3",{id:"\u7ec4\u4ef6\u5916\u90e8\u8bfb\u53d6-loading"},"\u7ec4\u4ef6\u5916\u90e8\u8bfb\u53d6 loading"),(0,l.kt)("p",null,"\u53ef\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"getMutateLoading")," \u3001 ",(0,l.kt)("inlineCode",{parentName:"p"},"getActionLoading")," \u3001",(0,l.kt)("inlineCode",{parentName:"p"},"getDeriveLoading")," \u83b7\u53d6\u76f8\u5bf9\u4e8e\u7684 loading \u72b6\u6001"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { getMutateLoading, getActionLoading, getDeriveLoading } from 'helux';\n\n// loading.xxx \u83b7\u53d6\u67d0\u4e2a mutate \u51fd\u6570\u7684\u5177\u4f53 loading \u72b6\u6001\nconst loading = getMutateLoading(someShared);\n\n// loading.xxx \u83b7\u53d6\u67d0\u4e2a action \u51fd\u6570\u7684\u5177\u4f53 loading \u72b6\u6001\nconst loading = getActionLoading(someShared);\n\n// \u83b7\u53d6\u67d0\u4e2a\u5168\u91cf\u6d3e\u751f\u7ed3\u679c\u7684\u5177\u4f53 loading \u72b6\u6001\nconst status = getDeriveLoading(someDerivedResult);\n")),(0,l.kt)("h2",{id:"\u6a21\u5757\u514b\u9686"},"\u6a21\u5757\u514b\u9686"),(0,l.kt)("h3",{id:"model"},"model"),(0,l.kt)("p",null,"\u63d0\u4f9b ",(0,l.kt)("inlineCode",{parentName:"p"},"model")," \u51fd\u6570\uff0c\u5e2e\u52a9\u7528\u6237\u6309\u4e1a\u52a1\u529f\u80fd\u805a\u5408\u7ba1\u7406\u76f8\u5173\u72b6\u6001\u4e0e\u64cd\u4f5c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const model = createModel((api) => {\n  // api\u5bf9\u8c61 \u6709\u8be6\u7ec6\u7684\u7c7b\u578b\u63d0\u793a\n  const userCtx = api.shareState({ a: 1, b: 2 });\n  const { state, setState } = userCtx;\n  const someResult = api.deriveAtom(() => state.a + 100);\n\n  function changeA() {\n    setState((draft) => {\n      draft.a += 1;\n    });\n  }\n\n  return {\n    changeA,\n    state,\n    someResult,\n    setState,\n  };\n});\n")),(0,l.kt)("h3",{id:"modelfactory"},"modelFactory"),(0,l.kt)("p",null,"\u63d0\u4f9b\u66f4\u9ad8\u9636\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"modelFactory")," \u51fd\u6570\uff0c\u5e2e\u52a9\u7528\u6237\u521b\u5efa\u53ef\u514b\u9686\u4f7f\u7528\u7684 model \u5de5\u5382\u51fd\u6570\uff0c\u505a\u5230\u903b\u8f91\u590d\u7528\u4f46\u72b6\u6001\u9694\u79bb\u7684\u6548\u679c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const factory = modelFactory((api, extra) => {\n  const userCtx = api.shareState({ a: 1, b: 2 }, { moduleName: extra });\n  const { state, setState } = userCtx;\n  const someResult = api.deriveAtom(() => state.a + 100);\n\n  function changeA() {\n    setState((draft) => {\n      draft.a += 1;\n    });\n  }\n\n  return {\n    changeA,\n    state,\n    someResult,\n    setState,\n  };\n});\nconst model1 = factory.build('Model1');\nconst model2 = factory.build('Model2');\n")),(0,l.kt)("h2",{id:"\u4e8b\u4ef6\u7cfb\u7edf"},"\u4e8b\u4ef6\u7cfb\u7edf"),(0,l.kt)("p",null,"\u5185\u90e8\u63d0\u4f9b\u4e8b\u4ef6\u603b\u7ebf\u8ba9\u7528\u6237\u53ef\u4ee5\u5168\u5c40\u4f7f\u7528"),(0,l.kt)("h3",{id:"\u53d1\u5c04\u4e8b\u4ef6"},"\u53d1\u5c04\u4e8b\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { emit } from 'helux';\n\nemit('xxx_event', 1, 2, 3);\n")),(0,l.kt)("h3",{id:"\u7ec4\u4ef6\u5916\u76d1\u542c\u4e8b\u4ef6"},"\u7ec4\u4ef6\u5916\u76d1\u542c\u4e8b\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { on } from 'helux';\n\nconst off = on('xxx_event', (...args) => {\n  console.log('received args ', args);\n});\noff(); // \u53d6\u6d88\u76d1\u542c\n")),(0,l.kt)("h3",{id:"\u7ec4\u4ef6\u5185\u76d1\u542c\u4e8b\u4ef6"},"\u7ec4\u4ef6\u5185\u76d1\u542c\u4e8b\u4ef6"),(0,l.kt)("p",null,"\u7ec4\u4ef6\u5185\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"useOnEvent")," \u94a9\u5b50\u51fd\u6570\u76d1\u542c\uff0c\u518d\u7ec4\u4ef6\u9500\u6bc1\u540e\u4f1a\u81ea\u52a8\u53d6\u6d88\u76d1\u542c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useOnEvent } from 'helux';\n\nfunction Demo() {\n  useOnEvent('xxx_event', (...args) => {\n    console.log('received args ', args);\n  });\n}\n")),(0,l.kt)("h2",{id:"\u4e2d\u95f4\u4ef6"},"\u4e2d\u95f4\u4ef6"),(0,l.kt)("p",null,"\u4e2d\u95f4\u4ef6\u662f\u4e00\u4e2a\u540c\u6b65\u51fd\u6570\uff0c\u5728\u72b6\u6001\u63d0\u4ea4\u524d\u88ab\u8c03\u7528\uff0c\u53ef\u901a\u8fc7\u4e2d\u95f4\u4ef6\u51fd\u505a\u4e00\u4e9b\u7edf\u4e00\u64cd\u4f5c\uff0c\u4f8b\u5982\u6570\u4fee\u6539\u8349\u7a3f\u7684\u65f6\u95f4\u5c5e\u6027"),(0,l.kt)("h3",{id:"\u5b9a\u4e49\u4e2d\u95f4\u4ef6"},"\u5b9a\u4e49\u4e2d\u95f4\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { Middleware } from 'helux';\n\nconst markTimeMiddleWare: Middleware = (params) => {\n  const { sharedKey, moduleName, draft } = params;\n  draft.time = Date.now();\n};\n")),(0,l.kt)("h3",{id:"\u4f7f\u7528\u4e2d\u95f4\u4ef6"},"\u4f7f\u7528\u4e2d\u95f4\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { addMiddleware } from 'helux';\n\naddMiddleware(markTimeMiddleWare);\n")),(0,l.kt)("h2",{id:"\u63d2\u4ef6"},"\u63d2\u4ef6"),(0,l.kt)("p",null,"\u63d2\u4ef6\u662f\u4e00\u4e2a\u666e\u901a\u5bf9\u8c61\uff0c\u5305\u542b\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"install"),"\u5c5e\u6027\uff0c\u5176\u503c\u5bf9\u5e94\u4e00\u4e2a\u51fd\u6570\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"helux"),"\u8c03\u7528\u8be5\u51fd\u6570\u540e\uff0c\u4f1a\u5c06\u4e00\u4e2a\u63d2\u4ef6\u4e0a\u4e0b\u6587\u5bf9\u8c61\u900f\u4f20\u7ed9\u7528\u6237\uff0c\u7528\u6237\u53ef\u4f7f\u7528\u8be5\u4e0a\u4e0b\u6587\u76d1\u542c\u6765\u81ea",(0,l.kt)("inlineCode",{parentName:"p"},"helux"),"\u5185\u90e8\u7684\u5404\u79cd\u884c\u4e3a\u4e8b\u4ef6\u5e76\u505a\u5bf9\u5e94\u7684\u5904\u7406\uff0c\u4f8b\u5982",(0,l.kt)("a",{parentName:"p",href:"https://github.com/heluxjs/helux/tree/master/packages/helux-plugin-redux-devtool"},"helux-plugin-redux-devtoo"),"\u63d2\u4ef6\u63a5\u6536\u72b6\u6001\u5df2\u6539\u53d8\u4e8b\u4ef6\uff0c\u5e76\u5c06\u5176\u5bf9\u5e94\u7684\u5feb\u7167\u5199\u5165\u5230 redux \u5f00\u53d1\u5de5\u5177\u7684\u72b6\u6001\u4e2d\uff0c\u65b9\u4fbf\u7528\u6237\u53ef\u89c6\u5316\u67e5\u770b\u6574\u4e2a\u5e94\u7528\u7684\u72b6\u6001\u6811\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://tnfe.gtimg.com/image/akpc29z24n_1699705611085.png",alt:null})),(0,l.kt)("h3",{id:"\u5f00\u53d1\u63d2\u4ef6"},"\u5f00\u53d1\u63d2\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { IPlugin } from 'helux';\n\nconst MyPlugin: IPlugin = {\n  install(ctx) {\n    ctx.on(EVENT_NAME.ON_DATA_CHANGED, (dataInfo) => {\n      // do some staff here\n    });\n    ctx.on(EVENT_NAME.ON_SHARE_CREATED, (dataInfo) => {\n      // do some staff here\n    });\n  },\n  name: pluginName,\n};\n")),(0,l.kt)("h3",{id:"\u5b89\u88c5\u63d2\u4ef6"},"\u5b89\u88c5\u63d2\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { addPlugin } from 'helux';\n\naddPlugin(MyPlugin);\n")))}d.isMDXComponent=!0}}]);